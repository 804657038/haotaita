<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
		<title>好太太</title>
		<link rel="stylesheet" href="css/index.css" />		
		<script type="text/javascript" src="js/lufylegend-1.10.1.min.js" ></script>	
		<script type="text/javascript" src="js/lufylegend.ui-0.14.1.min.js" ></script>
		<script src="js/jquery.min.js"></script>
        <script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
        <script type="text/javascript">
            window.link="https://haotaitai.hengdikeji.com/";
            window.fxTitle="";
            window.fxDesc="";
            window.fxLink="";
            window.fxImg="";
            window.shareNum=0; //分享测试
            window.hasGitf=false; //是否赠送
            function AjaxR(url,type,data,callback){
                $.ajax({
                    type:type,
                    url:url,
                    dataType:'JSON',
                    data:data,
                    success:function(res){
                        if(callback){
                            callback(res);
                        }
                        if(res.token){
                            window.token=res.token;
                        }
                    },
                    error:function(XMLHttpRequest){
                        if(XMLHttpRequest.status==408){
                            window.location.href= window.link+"weixin";
                        }
                    }
                });
            }
            function GetQueryString(name)
            {
                var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if(r!=null)return  unescape(r[2]); return null;
            }

        </script>
	</head>
	<body>
		<div id="good"></div>
		<div id="friendGrit" style="display: none;">
			<div class="friendGrit" >
				<ul>
					<li>
						<div class="head" id="face">
							<img src="" />
						</div>
					</li>
					<li>
						<p class="name" id="nickname"></p>
					</li>
					<li>
						<div class="geted">
							<p>你的好友赠送你一张</p>
							<div class="gifts">
								<img src="" />
							</div>
						</div>
						<div class="noget">
							<p>该券已被领取</p>
							<p>返回首页赢取大礼包</p>
						</div>
					</li>
					<li>
						<a href="###" class="nowget"><img src="img/nowget.png"/></a>
						<a href="###" class="confirmBtn"><img src="img/confirmBtn.png"/></a>
					</li>
				</ul>
			</div>
			<div class="getResult" hidden="hidden">
				<div class="getBoxF">
					<img src="img/getfail.png" />
					<a href="###" class="fine"></a>
				</div>
				<div class="getBoxS">
					<img src="img/getsuccess.png" />
					<a href="###" class="fine"></a>
				</div>
			</div>
		</div>
		<audio id="Jaudio"  preload loop="loop" src="music/bg.mp3" hidden="hidden"></audio >
		<audio id="shanks"  preload loop="loop" src="music/shank.mp3" hidden="hidden"></audio>

		<iframe id="personInfor" src="person.html" hidden="hidden"></iframe>
        
	</body>	
	<script type="text/javascript" src="js/publicFun.js" ></script>
	<script type="text/javascript" src="js/resource.js?v=1" ></script>
	<script type="text/javascript" src="js/target.js" ></script>
	<script type="text/javascript" src="js/musicBtn.js" ></script>
	<script type="text/javascript" src="js/gift.js" ></script>
	<script type="text/javascript" src="js/awardAndCard.js?v=17" ></script>
	<script type="text/javascript" src="js/compose.js?v=3" ></script>
	<script type="text/javascript" src="js/sendToFriend.js" ></script>
	<script type="text/javascript" src="js/main.js?v=7" ></script>
	<script>
			function audioAutoPlay(id,v){
			    var audio = document.getElementById(id);
			    audio.play();
			    if(v==0)
			    {
			    	audio.pause();
			    }
			    document.addEventListener("WeixinJSBridgeReady", function () {
			            audio.play();
			            if(v==0)
					    {
					    	audio.pause();
					    }
			    }, false);
			}
			audioAutoPlay('Jaudio');


            $.get(window.link+'',function(res){
                wx.config({
                    debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                    appId:''+res.appId+'', // 必填，公众号的唯一标识

                    timestamp: ''+res.timestamp+'', // 必填，生成签名的时间戳

                    nonceStr:''+res.nonceStr+'', // 必填，生成签名的随机串

                    signature:''+res.signature+'',// 必填，签名，见附录1

                    jsApiList: ['onMenuShareTimeline','onMenuShareAppMessage'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2

                });
            },"JSON");
            wx.ready(function () {
                wx.onMenuShareTimeline({
                    title: window.fxTitle,
                    link: window.fxLink,
                    imgUrl:window.fxImg,

                    success: function (res) {
                        if(window.hasGitf==true){
                            zs();
                        }else{
                            share(2);
                        }

                    },
                    cancel: function (res) {
                    },
                    fail: function (res) {
                        alert(JSON.stringify(res));
                    }
                });
                wx.onMenuShareAppMessage({
                    title: window.fxTitle,
                    link: window.fxLink,
                    desc:window.fxDesc,
                    imgUrl:window.fxImg,
                    success: function (res) {
                        if(window.hasGitf==true){
                            zs();
                        }else{
                            share(1);
                        }
                    },
                    cancel: function (res) {
                    },
                    fail: function (res) {
                        alert(JSON.stringify(res));
                    }
                });
            });
            function share(type){
                $.ajax({
                    url:window.link+"share/"+type,
                    type:"POST",
                    dataType:"JSON",
                    data:{},
                    async: false,
                    success:function(datas){
                        if(datas.code==1){
                            window.location.href="index.html?v="+Math.random();
                        }else{
                            alert(datas.msg);
                        }
                    },
                    error: function(datas) {
                        alert(datas.msg);
                    }
                });
            }
            function zs(){
                 AjaxR(window.link+'readyGive','POST',{id:window.gId,"type":window.gType,"__token__":window.token},function(res){
                 if(res.code==1){
                        window.location.href="index.html?v="+Math.random();
                 	}else{
                 	   alert("分享失败，请重新分享");
                 	}
                 });
            }
			audioAutoPlay('shanks',0);


	</script>
</html>
